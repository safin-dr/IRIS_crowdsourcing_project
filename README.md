# IRIS

В этом репозитории находится код для препроцессинга данных для разметки и подготовки самой разметки, а также код для обучения модели бинарной классификации и генерации финальных предсказаний.


Работу над проектом мы построили следующим образом:
- для экономии ресурсов в начале обучили пару ResNet-like моделей на имеющихся ground-truth данных;
- научились извлекать эмбеддинги для картинок, заменив последний слой модели;
- по расположению объектов с разным таргетом в пространстве эмбеддингов поняли, что у объектов одного класса получаются близкие эмбеддинги (при этом пересечение классов, конечно, непустое);
- извлекли эмбеддинги для всех имеющихся картинок, оценили количество неразмеченных картинок, которые можно достоверно классифицировать с помощью kNN или кластеризации в пространстве эмбеддингов; 
- выделили "проблемные" картинки - то есть те, которые в пространстве эмбеддингов ни с помощью KNN, ни с помощью кластеризации не получается достоверно определить к одному из классов;
- отправили на разметку "проблемные" и картинки, у которых в пространстве эмбеддингов среди ближайших соседей есть "проблемные" картинки;
- собрали итоговый датасет из ground-trut, размеченных толокерами и ранее достоверно классифицированных картинок;
- обучили на итоговом датасете KNN, перебрали у него немного гиперпараметров и применили к потенциально оставшимся неразмеченным картинкам (так как они немного могли меняться при разных инициализациях шага 2);
- после полученного полного датасета обучили ResNet-like модели.

Пайплайн разметки выглядел следующим образом:
- создали html файл с описанием, через API настроили проект;
- разделили ground-truth датасет на 3 части: 30 объектов на обучение, 20 на экзамен, оставшиеся на ханипоты;
- добавили информативные подсказки на обучении;
- для экзамена установили большое перекрытие, чтобы достаточное число исполнителей смогло добраться до боевой разметки;
- назначали навык исполнителям, достаточно успешно справившимся с экзаменационной разметкой;
- в пул с боевой разметкой добавили "проблемные" картинки и ханипоты, установили перекрытие 3;
- настроили контроль качества: быстрые ответы, точность на ханипотах, мнение большинства;
- выставили 1 ханипот на страницу из 50 заданий, поэтому исполнителям не представлялось возможным "слить" базу данных ханипотов для недобросовестной разметки;
- запустили все пулы, собрали данные.

Папка `crowdsourcing` содержит все необходимое для создания проекта разметки (ноутбук запускался из гугл колаба, часть настроек основного пула в конце выставлялись через UI).

Папка `training` содержит все необходимое для подготовки данных для разметки и конечное обучение на размеченном датасете:
- `train_model.ipynb` содержит подготовку данных для разметки (выделение подмножества "проблемных") картинок и сохранение эмбеддингов,
- `full_scale_training.ipynb` интегрирует полученный датасет, собирает и применяет финальную аггрегацию к неразмеченным семлпам, сплитит датасет и собирает посылку для контеста.
